# CPUについて

中央処理装置(CPU:Central Processing Unit)はコンピュータの中央（中枢部分）で制御と演算を行う装置です。

- 制御  
プログラムの命令を解釈し、コンピュータ全体の動作を制御する

- 演算  
四則演算などのあらゆる演算処理を行う  
この演算する装置は算術演算子(ALU:Artificatic and Logic Unit)と呼ばれることがある

## プログラムの命令解釈

CPU内部には制御の際に使用される*レジスタ*と*命令デコーダ*と呼ばれる装置が存在する

- レジスタ  
命令解釈をする際に必要なデータを保存する記憶装置  
レジスタには多くの種類がある

- 命令デコーダ  
命令の情報を解読し、必要な装置を呼び出す制御信号を飛ばす

レジスタの種類と特徴
|名称|特徴|
|---|---|
|プログラムカウンタ<br>（プログラムレジスタ）|次に実行する命令のアドレスを記憶する|
|命令レジスタ|取り出した命令を一時的に記憶する|
|インデックスレジスタ|連続したデータの取り出しに使用される増分値を記憶する|
|ベースレジスタ|プログラムの先頭アドレスを記憶する|
|アキュムレータ|演算対象の数字や演算結果を記憶する|
|汎用レジスタ|一時的な値の保持やアキュムレータなどの代用に使われる<br>演算装置の一部で特に機能を限定していない|

命令レジスタは命令部とオペランド部に分かれている
- 命令部  
命令の種類を示すコード番号が入っている
命令デコーダは命令部のコードを解読して使う
- オペランド部  
オペランド（処理対象になるデータ）のアドレスなどが入っている

## 命令を実行する手順
### 命令のフェッチ
1. プログラムカウンタから取り出す命令のアドレスを割り出す
2. 割り出したアドレスにある命令を取り出す
3. 取り出した命令を命令レジスタに記憶させる
4. プロググラムカウンタの値を1つ増加させて次取り出す命令の値にする

### 命令の解読

1. 命令レジスタ内の命令部に入っているコード番号を命令デコーダに渡す
2. 命令デコーダがコードを解読し必要な装置を呼び出す制御信号を飛ばす

### オペランド（対象データ）の読み出し

1. 命令レジスタ内のオペランド部にあるオペランドのアドレスにあるオペランドを読み出す
2. 読み出したオペランドを汎用レジスタに記憶させる

※1.はアドレス指定方式によって変わる

### 命令実行

1. オペランド（対象データ）の読み出しで汎用レジスタに記憶させたオペランドを  
命令の解読で呼び出した装置を使い演算する
2. 演算結果を汎用レジスタに記憶させる

## アドレス指定方式
命令レジスタのオペランド部にあるオペランドのアドレスがオペランドの場所を指定する方式が多数存在する

|アドレス指定方式|
|---|
|即値アドレス指定方式|
|直接アドレス指定方式|
|間接アドレス指定方式|
|インデックスアドレス指定方式|
|ベースアドレス指定方式|
|相対アドレス指定方式|

- 実効アドレス  
メモリでデータの入っている場所  
※アドレスの入っている場所は実行アドレスではない

### 即値アドレス指定方式

オペランド部の値をそのまま使うから即値  
そのため、メモリの参照は行われない

### 直接アドレス指定方式

オペランド部に実効アドレス（データのある場所）が直接書いている

### 間接アドレス指定方式

オペランド部の値が「オペランドのアドレス」が入っているメモリのアドレスを間接的に指定している

### インデックスアドレス指定方式

オペランド部に元の値のほされてもデックスレジスタ番号が保存される  
インデックスレジスタ内のインデックスレジスタ番号にある値トオペランド部の元の値を足すことにより実効アドレスを求める

```
インデックスレジスタにある値 + オペランド部の値 = 実効アドレス
```

このインデックスレジスタにある値を増減指せることにより、等間隔で並ぶアドレスへ同じ命令を繰り返し処理できる

- メリット  
変更される値はインデックスレジスタ内の値だけになるため、取得した命令(命令部、オペランド部の値、インデックスレジスタ番号)を変更しなくてもよくなり、高速で命令を処理することができる

### ベースアドレス指定方式

プログラムをメモリにロードされたときのメモリの先頭アドレスが入っているベースレジスタとオペランド部の値を足すことにより、実効アドレスを求める

```
ベースレジスタの値 + オペランド部の値 = 実効アドレス
```
- メリット  
プログラムがどこにロードされていても、命令を変えなくてよくなる
- デメリット  
ベースレジスタ分の記憶する領域が必要になる

### 相対アドレス指定方式

次に取り出す命令を記憶しているプログラムカウンタとオペランド部の値を足すことにより実効アドレスを求める

```
プログラムカウンタの値 + オペランド部の値 = 実効アドレス
```
- メリット  
プログラムがどこにロードされていても、命令を変えなくてよくなる
ベースアドレス指定方式に比べ、ベースレジスタがなくても相対的に実効アドレスをしてすることができる

